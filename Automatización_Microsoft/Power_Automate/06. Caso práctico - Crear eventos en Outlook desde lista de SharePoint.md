
---

# 06. Caso práctico - Crear eventos en Outlook desde lista de SharePoint


## Introducción

Este flujo de Power Automate crea eventos de calendario en Outlook a partir de nuevos elementos registrados en una lista de SharePoint. Al detectar altas en la lista de trabajo, compone el evento con los datos del elemento y actualiza el propio registro para dejar trazabilidad del identificador del evento y el estado.

No emplea modelos de IA; se basa en reglas explícitas de transformación y actualización para mantener la trazabilidad y el control.

---

## Contexto y objetivo del flujo

Se ha desarrollado una automatización que:

- Supervisa una lista de SharePoint del sitio de trabajo.
- Por cada nuevo elemento, crea un evento en el calendario de Outlook con asunto, ubicación, cuerpo y horario definidos.
- Actualiza el elemento de SharePoint con el estado del evento (p. ej., "Creada") y el identificador del evento en Outlook.
- Evita duplicados mediante la comprobación de un campo de identificador (p. ej., `OutlookID`).

El objetivo es mantener sincronizado el registro de actividades en SharePoint con el calendario corporativo, garantizando trazabilidad y evitando eventos repetidos.

---

## Configuración previa

Antes de activar el flujo, prepara estas dependencias.

### A) Lista en SharePoint (sitio de trabajo)

- **Sitio**: `https://[su-tenant].sharepoint.com/sites/[su-sitio]` (censurado)
- **Lista (ID interna)**: `[GUID de la lista de origen]` (censurado)

Columnas sugeridas en la lista:
- **Title** (Texto) — título base del evento (asunto)
- **Fechainicio** (Fecha y hora) — en UTC
- **Fechafin** (Fecha y hora) — en UTC
- **Entidad** (Texto)
- **Tipoactividad** (Elección) — usar el valor (`Tipoactividad/Value`)
- **Ubicación** (Texto) — nombre interno podría ser `Ubicaci_x00f3_n`
- **Observaciones** (Texto multilínea)
- **Estadoevento** (Elección) — valores: "Creada" | "Pendiente" | etc.
- **OutlookID** (Texto) — identificador del evento en Outlook (marca para evitar duplicados)

### B) Calendario en Outlook

- **Conector**: Office 365 Outlook
- **Calendario**: usar el calendario corporativo correspondiente (ID interno no publicado; censurado).
- **Zona horaria**: `(UTC+01:00) Brussels, Copenhagen, Madrid, Paris)`; conversión desde `UTC` a `Romance Standard Time`.

### C) Conexiones y permisos

- Conectores: **Office 365 Outlook** y **SharePoint Online** con permisos de lectura/escritura en el sitio y lista indicados.
- Disparador: **SharePoint** con sondeo recurrente (cada minuto) para nuevos elementos.
- Nombres y IDs de conexión: censurados y reemplazados por descriptores genéricos.


---

## Mapeo de acciones (detallado)

### TRIGGER: Cuando se crea un elemento (SharePoint)

**Acción:** SharePoint Online → `GetOnNewItems`

**Configuración:**
- **Site:** `https://[su-tenant].sharepoint.com/sites/[su-sitio]` (censurado)
- **Lista:** `[GUID de la lista de origen]` (censurado)
- **Recurrence:** frecuencia `Minute`, intervalo `1`
- **Split On/Dividir:** `@triggerOutputs()?['body/value']` ✅ ACTIVADO

---

### Condición evitar duplicados

**Nombre:** `Condición_evitar_duplicados` — If

**Expresión:**
- `and(not(equals(@triggerBody()?['OutlookID'], false)))`

**Comportamiento:** Solo ejecuta la creación/actualización si el registro no indica explícitamente `OutlookID = false`. La intención es evitar recrear eventos cuando ya existe un identificador.

---

### Crear evento en Outlook

**Acción:** `Crear_evento_(V4)` — Office 365 Outlook → `V4CalendarPostItem`

**Campos:**
- **Subject:** `Title`
- **Start/End:** conversión de `Fechainicio` y `Fechafin` desde `UTC` a `Romance Standard Time` (`yyyy-MM-ddTHH:mm:ss`).
- **TimeZone:** `(UTC+01:00) Brussels, Copenhagen, Madrid, Paris)`
- **Location:** `Ubicaci_x00f3_n`
- **Body (HTML):** compone un cuerpo con los datos `Entidad`, `Tipoactividad/Value`, `Ubicaci_x00f3_n`, fecha/hora de inicio formateada y `Observaciones`.
- **Reminder:** activado, 15 minutos antes del inicio.

---

### Actualizar elemento en SharePoint

**Acción:** `Actualizar_elemento` — SharePoint Online → `PatchItem`

**Configuración:**
- **id:** `@triggerBody()?['ID']`
- **Estadoevento:** `Creada`
- **OutlookID:** `@outputs('Crear_evento_(V4)')?['body/id']`

---

### Finalizar

**Acción:** `Finalizar` — `Terminate`
- **Estado:** `Succeeded`

---

## Flujo visual (detallado)

```
┌─────────────────────────────────────────────────────────────────┐
│ TRIGGER: Cuando se crea un elemento (SharePoint)                │
│ Site: [su-sitio] | Lista: [GUID] | Split On: Enabled           │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│ If: Condición_evitar_duplicados                                 │
│  (verifica campo OutlookID)                                      │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│ Crear_evento_(V4) (Outlook)                                      │
│  Subject, Start/End (UTC→Romance), Location, Body HTML, Reminder │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│ Actualizar_elemento (SharePoint)                                 │
│  Estadoevento = Creada, OutlookID = id del evento                │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│ FINALIZAR (Succeeded)                                           │
└─────────────────────────────────────────────────────────────────┘
```

---

## Notas de control manual

- **Zona horaria y formato**: `Fechainicio`/`Fechafin` deben estar en UTC; el flujo convierte a `Romance Standard Time` y fija `item/timeZone` a la zona horaria correspondiente.
- **Evitar duplicados**: `OutlookID` actúa como marca. Si el elemento ya tiene un `OutlookID` válido, no debe recrearse el evento.
- **Campos dependientes**: si alguna columna (p. ej. `Tipoactividad`) es de tipo elección, asegúrate de usar el valor (`.../Value`) según se define en el flujo.
- **Ubicación**: el campo puede aparecer en la definición como `Ubicaci_x00f3_n`; valida el nombre interno en SharePoint.
- **Privacidad**: los nombres de sitio, tenant, IDs y conexiones se han censurado; sustitúyelos por los de su organización al implementar.

---

## Riesgos y limitaciones

- **Desfase horario**: si los datos no están en UTC, la conversión puede resultar en horarios incorrectos; homogeneizar la entrada.
- **Estructura HTML**: el cuerpo del evento inserta HTML simple; clientes que no muestren HTML pueden ver formato básico.
- **Duplicados por lógica**: si la condición de duplicado no contempla nulos/vacíos correctamente, podrían crearse eventos repetidos; revisar la expresión en escenarios reales.
- **Conectores y permisos**: cualquier cambio de conexiones o permisos en SharePoint/Outlook puede interrumpir el flujo.

---

## Conclusión

El flujo sincroniza nuevas actividades registradas en SharePoint con el calendario de Outlook, dejando trazabilidad mediante `Estadoevento` y `OutlookID`. Su diseño favorece la auditabilidad y el control operativo, con especial atención a la zona horaria y a la prevención de duplicados.

---

## Uso con App complementaria (Power App)

Esta herramienta está pensada para usarse con una App complementaria (Power App) construida sobre la lista de SharePoint, que permite gestionar y registrar elementos de forma ágil y sencilla desde el móvil. La App facilita la creación y edición de registros, estandariza campos clave (fechas en UTC, valores de elección), y mejora la operativa en movilidad manteniendo la privacidad y los permisos de la organización.
