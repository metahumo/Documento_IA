

---

# Guía para obtener un archivo adjunto de mail en OneDrive con Power Automate

En esta guía aprenderemos a automatizar la descarga de archivos adjuntos recibidos por correo electrónico y su almacenamiento directo en una carpeta de OneDrive usando Power Automate. Veremos cómo configurar un flujo que detecte correos específicos, identifique los adjuntos y los guarde automáticamente, reduciendo errores humanos y optimizando nuestro tiempo en tareas repetitivas. Esta guía está pensada para usuarios que quieran aplicar la automatización en entornos de trabajo diario de forma segura y eficiente.

---

## Iniciar entorno

Para automatizar esta tarea, necesitamos nuestra cuenta de Office 365. Para entornos corporativos, usamos el correo proporcionado por la empresa e iniciamos sesión en nuestra cuenta. Puedes acceder a Office 365 desde este enlace: [https://www.office.com/](https://www.office.com/). Se recomienda abrir una pestaña con el correo y otra con nuestra sesión de OneDrive para mayor comodidad.

![Captura](./Images/outlook_01.png)

Desde el apartado **Mis archivos** se recomienda crear una carpeta apropiada para almacenar los archivos adjuntos que vamos a automatizar.

![Captura](./Images/onedrive_01.png)

Para acceder a Power Automate, tenemos varias opciones. Una forma fácil y accesible es mediante el desplegable en la parte superior izquierda de nuestra sesión de Office 365. Allí hacemos clic en **Power Automate** y se abrirá su interfaz.

![Captura](./Images/outlook_02.png)

Para iniciar una automatización podemos hacerlo desde:

- **Crear** → **Flujo de nube automatizado**, o
    
- **Mis flujos** → **Nuevo flujo** → **Flujo de nube automatizado**.

![Captura](./Images/automate_01.png)

![Captura](./Images/automate_02.png)

![Captura](./Images/automate_03.png)

Se recomienda usar la opción **Omitir** al iniciar el flujo para poder configurar la automatización según nuestras necesidades y tener un control total de los parámetros y acciones.

![Captura](./Images/automate_04.png)

---

## Configuración del proceso de automatización

Hacemos clic en la pestaña **Agregar un desencadenador**, lo que abrirá un desplegable con todas las opciones disponibles.

![Captura](./Images/automate_05.png)

En la barra de búsqueda escribimos **Outlook** y seleccionamos el desencadenador que nos interese. En este ejemplo, elegimos **Cuando llega un nuevo correo electrónico (V3)**.

![Captura](./Images/automate_34.png)

Se creará el apartado correspondiente y, al pinchar sobre él, se desplegarán las opciones de configuración.

![Captura](./Images/automate_06.png)

En algunos casos al iniciar este apartado puede requerirse iniciar sesión de nuevo, aunque no es lo habitual.

![Captura](./Images/automate_08.png)

En este apartado debemos indicar los **Parámetros** que determinarán qué correos serán automatizados:

- Hacemos clic en **Mostrar todo** para ver todas las opciones disponibles.
    
- **From (De):** indicamos los remitentes que queremos filtrar. Para pruebas, podemos poner nuestro propio correo y enviar un correo de prueba.
    
- **Importancia:** seleccionamos **Alta** si queremos automatizar solo correos urgentes.
    
- **Incluir datos adjuntos:** seleccionamos **Sí** para procesar únicamente correos con adjuntos.
    
- **Carpeta de origen:** indicamos **Inbox** para usar la bandeja principal de correo.
    

No es necesario modificar otros parámetros para este ejemplo.

![Captura](./Images/automate_09.png)

![Captura](./Images/automate_10.png)

Con estos valores configurados, agregamos un nuevo apartado haciendo clic en el símbolo **+**.

![Captura](./Images/automate_12.png)

En el desplegable, accedemos a la pestaña **Control**, y dentro de ella seleccionamos **Aplicar a cada uno**. Esto nos permitirá procesar todos los adjuntos de cada correo que cumpla con los filtros establecidos previamente.

![Captura](./Images/automate_11.png)

![Captura](./Images/automate_15.png)

Dentro de **Aplicar a cada uno** (el bucle sobre los adjuntos) hacemos clic en el **+** y en la barra de búsqueda activamos el icono del rayo (contenido dinámico).

![Captura](./Images/automate_16.png)

En el panel de contenido dinámico seleccionamos la entrada que corresponde a **Datos adjuntos** o **Attachments**, según el idioma. Esto es lo que le indica al sistema que vamos a procesar cada adjunto del correo.

![Captura](./Images/automate_17.png)

En el **+** dentro del bucle buscamos por **adjunto** y elegimos **Obtener datos adjuntos (V2)** (Office 365 Outlook).

![Captura](./Images/automate_18.png)

![Captura](./Images/automate_13.png)

![Captura](./Images/automate_19.png)

Ahora configuramos los dos campos obligatorios:

- **Identificador del mensaje (Message Id):**  
    Insertamos el contenido dinámico llamado **Identificador del mensaje** (puede buscarse por `id` en el panel de contenido dinámico).
    
    > Nota: si el trigger usa `splitOn` (v3), lo correcto en expresiones es obtener el id del primer elemento con:  
    > `@triggerOutputs()?['body/id']`  
    > Pero en la mayoría de casos —y más accesible— basta con seleccionar **Identificador del mensaje** desde el contenido dinámico.

![Captura](./Images/automate_20.png)

![Captura](./Images/automate_21.png)

- **Id. del archivo adjunto (Attachment Id):**  
	Muy importante: en el buscador de contenido dinámico escribe `Id.` (fíjate en el punto final). Selecciona la opción que aparece exactamente como **Datos adjuntos Id.** o **Attachments Id.** (no el `contentId`, ni otros `Id` que pertenezcan a niveles distintos).  

	Si elegimos la opción incorrecta, el flujo intentará obtener un `attachmentId` inválido y fallará.

![Captura](./Images/automate_22.png)

## Consejos prácticos y comprobaciones rápidas

- En el panel de contenido dinámico, si no ves `Attachments` o `Id.` pulsa **Mostrar más** o **Mostrar contenido adicional**.
    
- Evita crear manualmente `Apply to each` fuera del contexto correcto; lo ideal es añadir la acción `Obtener datos adjuntos (V2)` y dejar que Power Automate genere el bucle cuando detecte la colección.

![Captura](./Images/automate_23.png)

Si abrimos **Vista de código** (o la representación JSON del flujo) la acción **Obtener datos adjuntos (V2)** debería mostrar los parámetros con expresiones que apunten al correo y al adjunto. Un ejemplo claro y funcional es el siguiente (fragmento JSON):

```json
{
  "type": "OpenApiConnection",
  "inputs": {
    "parameters": {
      "messageId": "@triggerOutputs()?['body/id']",
      "attachmentId": "@item()?['id']"
    },
    "host": {
      "apiId": "/providers/Microsoft.PowerApps/apis/shared_office365",
      "connection": "shared_office365",
      "operationId": "GetAttachment_V2"
    }
  }
}
```

- `messageId` apunta al id del correo (aquí usamos `first(...)` porque el trigger V3 coloca correos en `body/value[]`).
    
- `attachmentId` usa `@item()?['id']`, que es **el id del adjunto dentro del bucle Apply to each**.
    

Si en tu Vista de código el campo `attachmentId` aparece vacío (`""`) o con alguna expresión distinta (por ejemplo `@item()?['contentId']` cuando no existe), el flujo fallará con `attachmentId cannot be null or empty`.

![Captura](./Images/automate_24.png)

Dentro del último bloque del flujo hacemos clic en **+** y en la barra de búsqueda escribimos _crear archivo_. 

Seleccionamos la acción correspondiente a **OneDrive para la Empresa → Crear archivo**.

![Captura](./Images/automate_25.png)

En el panel de configuración de esta acción completamos los parámetros:

**Ruta de acceso de la carpeta**

- Pinchamos en el icono de la carpeta de la derecha.
    
- Por defecto veremos **Root** (la carpeta principal de _Mis archivos_ en OneDrive).
    
- Si al abrir este selector nos pide iniciar sesión, iniciamos sesión con nuestra cuenta corporativa.
    
- Navegamos por las carpetas hasta seleccionar aquella donde queramos almacenar los adjuntos.

![Captura](./Images/automate_27.png)

![Captura](./Images/automate_28.png)

**Nombre de archivo**

- Podemos utilizar el campo dinámico **Nombre** o **Asunto**, según el formato de nombre que queramos.
    
- Esto será la forma en la que se guardará el archivo dentro de la carpeta seleccionada.

![Captura](./Images/automate_29.png)

**Contenido del archivo**

- Seleccionamos el contenido dinámico **Bytes de contenido**, que corresponde directamente al archivo adjunto descargado.

![Captura](./Images/automate_30.png)

---

## Guardar el flujo y revisar las ejecuciones

Una vez configurados todos los pasos:

1. Guardamos nuestro flujo con el botón **Guardar**.
    
2. Pulsamos en **Atrás** en la parte superior izquierda para volver a la vista general.
    
3. Desde **Mis flujos → [Nombre del flujo]** podemos consultar el estado de las ejecuciones.

![Captura](./Images/automate_31.png)

Cuando recibamos un correo que cumpla los filtros definidos:

- Puede haber un pequeño retraso (unos 15 segundos aproximadamente) antes de que aparezca la nueva ejecución.
    
- Al actualizar la página veremos el estado:
    
    - **En ejecución**: el flujo está procesando el correo.
        
    - **Correcto**: todo se ha ejecutado bien.
        
    - **Error**: ha fallado algún punto y podemos revisarlo.
        

En caso de error, Power Automate nos mostrará las acciones exactas que fallaron, y podemos apoyarnos en **Copilot** para entender el motivo y corregirlo.

![Captura](./Images/automate_32.png)

---

## Verificar el archivo en OneDrive

Finalmente, accedemos a nuestra sesión de OneDrive y abrimos la carpeta que seleccionamos durante la configuración.  

Allí deberíamos ver los archivos adjuntos extraídos de los correos que cumplan los criterios establecidos en nuestro flujo.

![Captura](./Images/automate_33.png)

El flujo de trabajo final es el siguiente:

```text
Trigger: Cuando llega un nuevo correo electrónico (V3)
     ↓
Apply to each / Aplicar a cada uno (Attachments)
     ↓
Obtener datos adjuntos (V2)
     ↓
Crear archivo (OneDrive)
```

---

## Tips y consejos

A continuación recogemos una serie de recomendaciones útiles que nos ayudarán a evitar errores frecuentes y a trabajar de forma más eficiente con Power Automate:

### 1. Probar siempre con casos simples

Antes de automatizar correos corporativos reales, conviene hacer pruebas enviándonos mensajes a nosotros mismos. Esto nos permite validar que los filtros, adjuntos y rutas funcionan correctamente sin afectar a terceros.

### 2. Evitar usar filtros demasiado restrictivos al principio

Si indicamos demasiados parámetros (como asunto, importancia, remitente, palabras clave…), podemos impedir que el flujo se active. Es mejor empezar con uno o dos filtros y ampliar progresivamente.

### 3. Confirmar siempre que usamos los campos dinámicos correctos

Power Automate ofrece varios campos con nombres parecidos, especialmente los relacionados con los adjuntos (por ejemplo, _Id del adjunto_, _Id_, _ContentId_, etc.).  
Debemos asegurarnos de que el campo insertado coincide exactamente con lo que requiere la acción, ya que uno incorrecto generará errores.

### 4. Usar “Aplicar a cada uno” cuando trabajamos con adjuntos

Un correo puede tener cero, uno o múltiples archivos adjuntos.  
Si no envolvemos las acciones en un bucle, el flujo puede fallar o solo procesar el primer adjunto. “Aplicar a cada uno” garantiza que el flujo gestiona cada archivo por separado.

### 5. Revisar los permisos de OneDrive

Si la carpeta que seleccionamos pertenece a un espacio compartido o a otro usuario, es posible que tengamos problemas de permisos. Antes de guardar archivos, confirmamos que tenemos acceso completo de escritura en esa ubicación.

### 6. Mantener rutas y nombres de archivo claros

Para evitar sobreescrituras accidentales o nombres duplicados:

- Podemos añadir fecha y hora al nombre del archivo.
    
- Podemos incluir palabras clave del asunto.
    
- Podemos usar una estructura de carpetas organizada según proyecto o departamento.

### 7. Supervisar las primeras ejecuciones

Después de crear el flujo, durante los primeros días es buena práctica revisar:

- Si los archivos realmente llegan a la carpeta deseada.
    
- Si alguna ejecución falla repetidamente.
    
- Si la automatización se activa en correos inesperados.  

Esto permite ajustar los filtros antes de dar el flujo por definitivo.

### 8. Documentar los cambios

Si más personas de nuestra organización van a utilizar este flujo, conviene anotar:

- Qué correos procesa el flujo
    
- En qué carpeta guarda los archivos
    
- Qué condiciones activan la automatización
    
- Qué hacer en caso de errores  
    Esto facilita el soporte y evita confusiones.

### 9. No acumular demasiadas acciones en un mismo flujo

Si más adelante añadimos pasos adicionales (copiar, renombrar, enviar notificaciones…), es preferible mantener una estructura clara.  

Los flujos demasiado largos dificultan el mantenimiento y pueden provocar errores más difíciles de depurar.

### 10. Hacer uso del historial y Copilot

El historial de ejecuciones permite ver qué acción falló y por qué. 

Además, Copilot ofrece explicaciones precisas y puede sugerir cómo corregir el problema, lo que acelera mucho la resolución de incidencias.

---
